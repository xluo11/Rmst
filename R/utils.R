# items <- item_pool(c('3pl', 'grm'), n=c(400, 30, 30))
# x <- mst(items, '1-2-2', 2, 'topdown', test_len=20, max_use=1)
# x <- mst_objective(x, seq(-1.5, -0.5, .5), indices=1)
# x <- mst_objective(x, seq( 0.5,  1.5, .5), indices=2)
# x <- mst_assemble(x, time_limit=10)
# plot(x, byroute=FALSE)
# plot(x, byroute=TRUE)
#
#
# panel <- 1
# modules <- c(1, 2)
# theta <- seq(-3, 3, 1)
# rdp <- c(- 1, 1)
#
# routing_prob <- function(x, panel, modules, theta, rdp) {
#   info <- mst_form_tif(mst_get_items(x, panel_ix=panel, module_ix=modules), thetas=theta)
#   se <- 1 / sqrt(info$info)
#   prob <- sapply(rdp, pnorm, mean=t, sd=se)
#   cbind(prob, 1) - cbind(0, prob)
# }
#
# routing_prob(x, panel, modules, theta, rdp)
#
#
# routing_error <- function(x, panel, modules, theta, rdp) {
#   info <- mst_form_tif(mst_get_items(x, panel_ix=panel, module_ix=modules), thetas=theta)
#   se <- 1 / sqrt(info$info)
#   prob <- sapply(rdp, pnorm, mean=t, sd=se)
#   ifelse(outer(theta, rdp, "<"), 1 - prob, prob)
# }
#
# routing_error(x, panel, modules, theta, rdp)
#
#
# hermite_gauss <- function(degree=c('20', '11', '7')){
#   switch(match.arg(degree),
#          '20'=list(t=c(-5.38748089001123,-4.60368244955074,-3.94476404011562,-3.34785456738321,-2.78880605842813,-2.25497400208927,-1.73853771211658,-1.23407621539532,-0.737473728545394,-0.245340708300901,0.245340708300901,0.737473728545394,1.23407621539532,1.73853771211658,2.25497400208927,2.78880605842813,3.34785456738321,3.94476404011562,4.60368244955074,5.38748089001123),
#                    w=c(2.22939364553415E-13,4.39934099227318E-10,1.08606937076928E-07,7.80255647853206E-06,0.000228338636016353,0.00324377334223786,0.0248105208874636,0.109017206020023,0.286675505362834,0.46224366960061,0.46224366960061,0.286675505362834,0.109017206020023,0.0248105208874636,0.00324377334223786,0.000228338636016353,7.80255647853206E-06,1.08606937076928E-07,4.39934099227318E-10,2.22939364553415E-13)),
#          '11'=list(t=c(-3.66847084655958,-2.78329009978165,-2.02594801582575,-1.32655708449493,-0.656809566882099,0,0.656809566882099,1.32655708449493,2.02594801582575,2.78329009978165,3.66847084655958),
#                    w=c(1.43956039371425E-06,0.000346819466323345,0.0119113954449115,0.117227875167708,0.429359752356125,0.654759286914591,0.429359752356125,0.117227875167708,0.0119113954449115,0.000346819466323345,1.43956039371425E-06)),
#          '7'=list(t=c(-2.651961356835233492447,-1.673551628767471445032,-0.8162878828589646630387,0,0.8162878828589646630387,1.673551628767471445032,2.651961356835233492447),
#                   w=c(9.71781245099519154149E-4,0.05451558281912703059218,0.4256072526101278005203,0.810264617556807326765,0.4256072526101278005203,0.0545155828191270305922,9.71781245099519154149E-4)))
# }
#
# theta <- seq(-3, 3, .1)
# error <- routing_error(x, 1, c(1, 2), theta, 0)
# colMeans(error * dnorm(theta))
